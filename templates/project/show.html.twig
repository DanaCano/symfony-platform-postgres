{% extends 'base.html.twig' %}
{% block title %}Projet {{ project.title }}{% endblock %}
{% block body %}
  <h1 class="mb-3">{{ project.title }}</h1>
  <p>{{ project.description }}</p>
  <p><small class="text-muted">Publié par <strong>{{ project.owner.name }}</strong> le {{ project.createdAt|date("Y-m-d H:i") }}</small></p>

  {% if app.user and (project.owner.id == app.user.id or is_granted('ROLE_ADMIN')) %}
  <div class="mb-3">
    <a class="btn btn-outline-primary" href="{{ path('app_project_edit', {id: project.id}) }}">Modifier</a>
    <form class="d-inline" method="post" action="{{ path('app_project_delete', {id: project.id}) }}" onsubmit="return confirm('Supprimer ce projet ?');">
      <input type="hidden" name="_token" value="{{ csrf_token('delete_project_' ~ project.id) }}">
      <button class="btn btn-outline-danger">Supprimer</button>
    </form>
  </div>
    <h3 class="mt-5">Candidatures reçues</h3>
    {% if project.applications|length > 0 %}
      {% for application in project.applications %}
        <div class="card mb-3">
          <div class="card-body">
            <p><strong>{{ application.applicant.name }}</strong>:</p>
            <p>"{{ application.message }}"</p>
            <p class="text-muted"><small>{{ application.createdAt|date("Y-m-d H:i") }}</small></p>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p>Il n'y a pas encore de candidatures pour ce projet.</p>
    {% endif %}
  {% else %}
    {% if app.user %}
      <h3 class="mt-4">Postuler à ce projet</h3>
      <form id="apply-form" data-project-id="{{ project.id }}" method="post">
        <div class="mb-3">
          <label for="message" class="form-label">Message de candidature</label>
          <textarea id="message" name="message" class="form-control" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-success">Envoyer votre candidature</button>
      </form>
    {% else %}
      <p class="mt-4">
        <a href="{{ path('app_login') }}">Se connecter</a> ou <a href="{{ path('app_register') }}">inscrivez-vous</a> pour postuler à ce projet.
      </p>
    {% endif %}
  {% endif %}
{% endblock %}
